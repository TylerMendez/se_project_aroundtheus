!function(){"use strict";class e{constructor(e,t,s,r,n){this._name=e.name,this._link=e.link,this._id=e._id,this._isLiked=e.isLiked,this._cardSelector=t,this._handleImageClick=s,this._handleCardDelete=r,this._handleCardLike=n}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._likeButton&&this._likeButton.addEventListener("click",(()=>this._handleCardLike(this))),this._deleteButton&&this._deleteButton.addEventListener("click",(()=>this._handleCardDelete(this))),this._cardImageElement&&this._cardImageElement.addEventListener("click",(()=>this._handleImageClick({name:this._name,link:this._link})))}updateLikeState(e){this._isLiked=e,e?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active")}removeCard(){this._element&&(this._element.remove(),this._element=null)}generateCard(){return this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".card__like-button"),this._deleteButton=this._element.querySelector(".card__delete-button"),this._cardImageElement=this._element.querySelector(".card__image"),this._element.querySelector(".card__title").textContent=this._name,this._cardImageElement.src=this._link,this._cardImageElement.alt=this._name,this._isLiked&&this._likeButton.classList.add("card__like-button_active"),this._setEventListeners(),this._element}}class t{constructor(e,t){this._settings=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._buttonElement=this._formElement.querySelector(this._settings.submitButtonSelector)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._buttonElement&&(this._hasInvalidInput()?this.disableButton():(this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.disabled=!1))}_checkInputValidity(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.validity.valid?(e.classList.remove(this._settings.inputErrorClass),t.textContent="",t.classList.remove(this._settings.errorClass)):(e.classList.add(this._settings.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._settings.errorClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._setEventListeners()}resetValidation(){this._buttonElement&&(this._toggleButtonState(),this._inputList.forEach((e=>{const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._settings.inputErrorClass),t.textContent="",t.classList.remove(this._settings.errorClass)})))}disableButton(){this._buttonElement.classList.add(this._settings.inactiveButtonClass),this._buttonElement.disabled=!0}}class s{constructor(e,t){let{items:s,renderer:r}=e;if(this._items=s,this._renderer=r,this._container=document.querySelector(t),!this._container)throw new Error(`Container with selector ${t} not found`)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}class r{constructor(e){if(this._popup=document.querySelector(e),!this._popup)throw new Error(`Popup with selector ${e} not found`);this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target===this._popup||e.target.classList.contains("modal__close-button"))&&this.close()}))}}class n extends r{constructor(e,t){if(super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector("form"),!this._form)throw new Error(`Form element not found in popup with selector ${e}`);this._inputList=Array.from(this._form.querySelectorAll("input")),this._submitButton=this._form.querySelector("button[type='submit']"),this._defaultButtonText=this._submitButton.textContent}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t)}))}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}renderLoading(e){this._submitButton.textContent=e?"Saving...":this._defaultButtonText}close(){super.close(),this._form.reset()}}const i={inputSelector:".modal__input",submitButtonSelector:".modal__button-save",inactiveButtonClass:"modal__button-save_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_active"},o=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}async getUserInfo(){try{const e=await fetch(`${this._baseUrl}/users/me`,{headers:this._headers});return this._checkResponse(e)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async getInitialCards(){try{const e=await fetch(`${this._baseUrl}/cards`,{headers:this._headers});return this._checkResponse(e)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async updateUserProfile(e){try{const t=await fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})});return this._checkResponse(t)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async updateAvatar(e){try{const t=await fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})});return this._checkResponse(t)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async addNewCard(e){try{const t=await fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})});return this._checkResponse(t)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async deleteCard(e){try{const t=await fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers});return this._checkResponse(t)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async likeCard(e){try{const t=await fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers});return this._checkResponse(t)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}async dislikeCard(e){try{const t=await fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers});return this._checkResponse(t)}catch(e){return Promise.reject(`Network error: ${e.message}`)}}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"84fdac63-ca2f-4986-bdd8-bb1fbbff275f","Content-Type":"application/json"}});let a;Promise.all([o.getUserInfo(),o.getInitialCards()]).then((e=>{let[t,r]=e;v.setUserInfo({name:t.name,job:t.about,avatar:t.avatar}),a=new s({items:r,renderer:e=>{const t=I(e);a.addItem(t)}},".cards__list"),a.renderItems()})).catch((e=>{console.error("Error loading initial data from server:",e)}));const l=document.querySelector("#profile-edit-form"),c=document.querySelector("#add-new-place-form"),d=document.querySelector("#avatar-form"),h=document.querySelector("#profile-edit-button"),u=document.querySelector(".profile__add-button"),_=document.querySelector("#avatar-edit-button"),m=document.querySelector("#profile-title-input"),p=document.querySelector("#profile-description-input"),f="#card-template",v=new class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:r}=e;if(this._name=document.querySelector(t),this._job=document.querySelector(s),this._avatar=document.querySelector(r),!this._name||!this._job||!this._avatar)throw new Error("One or more selectors are invalid")}setUserInfo(e){let{name:t,job:s,avatar:r}=e;this._name.textContent=t,this._job.textContent=s,r&&(this._avatar.src=r)}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent}}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__image"}),b=new n("#avatar-modal",(e=>{b.renderLoading(!0),o.updateAvatar({avatar:e.avatar}).then((e=>{v.setUserInfo({name:e.name,job:e.about,avatar:e.avatar}),b.close()})).catch((e=>console.error("Error updating avatar:",e))).finally((()=>{b.renderLoading(!1)}))}));b.setEventListeners();const E=new t(i,d);E.enableValidation(),_.addEventListener("click",(()=>{E.resetValidation(),b.open()}));const g=new class extends r{open(e,t){const s=this._popup.querySelector(".modal__image"),r=this._popup.querySelector(".modal__caption");if(!s||!r)throw new Error("Image or caption element not found in popup");s.src=t,s.alt=e,r.textContent=e,super.open()}}("#picture-modal");g.setEventListeners();const k=new n("#profile-edit-modal",(e=>{k.renderLoading(!0),o.updateUserProfile({name:e.title,about:e.description}).then((e=>{v.setUserInfo({name:e.name,job:e.about,avatar:e.avatar}),k.close()})).catch((e=>console.error("Error updating profile:",e))).finally((()=>{k.renderLoading(!1)}))}));k.setEventListeners();const y=new n("#profile-add-modal",(e=>{y.renderLoading(!0),o.addNewCard({name:e.title,link:e.url}).then((e=>{const t=I(e);a.addItem(t),y.close()})).catch((e=>console.error("Error adding new card:",e))).finally((()=>{y.renderLoading(!1)}))}));y.setEventListeners();const L=new class extends r{constructor(e){if(super(e),this._form=this._popup.querySelector("form"),!this._form)throw new Error(`Form element not found in popup with selector ${e}`)}setSubmitAction(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit&&this._handleSubmit()}))}close(){super.close(),this._form.reset()}}("#delete-card-modal");function S(e){L.setSubmitAction((()=>{o.deleteCard(e._id).then((()=>{e.removeCard(),L.close()})).catch((e=>console.error("Error deleting card:",e)))})),L.open()}function C(e){e._isLiked?o.dislikeCard(e._id).then((t=>{e.updateLikeState(!1)})).catch((e=>console.error("Error disliking card:",e))):o.likeCard(e._id).then((t=>{e.updateLikeState(!0)})).catch((e=>console.error("Error liking card:",e)))}function w(e){g.open(e.name,e.link)}function I(t){return new e(t,f,w,S,C).generateCard()}L.setEventListeners();const q=new t(i,l);q.enableValidation();const $=new t(i,c);$.enableValidation(),h.addEventListener("click",(()=>{const e=v.getUserInfo();m.value=e.name,p.value=e.job,q.resetValidation(),k.open()})),u.addEventListener("click",(()=>{$.resetValidation(),y.open()})),_.addEventListener("click",(()=>{E.resetValidation(),b.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL3BvcHVwd2l0aGNvbmZpcm1hdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUltYWdlQ2xpY2ssIGhhbmRsZUNhcmREZWxldGUsIGhhbmRsZUNhcmRMaWtlKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7XHJcbiAgICB0aGlzLl9pc0xpa2VkID0gZGF0YS5pc0xpa2VkO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XHJcbiAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlID0gaGFuZGxlQ2FyZERlbGV0ZTtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRMaWtlID0gaGFuZGxlQ2FyZExpa2U7ICAgIFxyXG4gIH1cclxuICBcclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG4gIFxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIGlmICh0aGlzLl9saWtlQnV0dG9uKSB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUNhcmRMaWtlKHRoaXMpKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLl9kZWxldGVCdXR0b24pIHtcclxuICAgICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlKHRoaXMpKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLl9jYXJkSW1hZ2VFbGVtZW50KSB7XHJcbiAgICAgIHRoaXMuX2NhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh7IG5hbWU6IHRoaXMuX25hbWUsIGxpbms6IHRoaXMuX2xpbmsgfSlcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgdXBkYXRlTGlrZVN0YXRlKGlzTGlrZWQpIHtcclxuICAgIHRoaXMuX2lzTGlrZWQgPSBpc0xpa2VkO1xyXG4gICAgaWYgKGlzTGlrZWQpIHtcclxuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICByZW1vdmVDYXJkKCkge1xyXG4gICAgaWYgKHRoaXMuX2VsZW1lbnQpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xyXG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcclxuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlRWxlbWVudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbGVtZW50LnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbGVtZW50LmFsdCA9IHRoaXMuX25hbWU7XHJcbiAgICBpZiAodGhpcy5faXNMaWtlZCkge1xyXG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgdGhpcy5fc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfaGFzSW52YWxpZElucHV0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xyXG4gICAgaWYgKCF0aGlzLl9idXR0b25FbGVtZW50KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xyXG4gICAgICB0aGlzLmRpc2FibGVCdXR0b24oKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcclxuICAgIGlmICghdGhpcy5fYnV0dG9uRWxlbWVudCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgICApO1xyXG4gICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGlzYWJsZUJ1dHRvbigpIHtcclxuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gICAgaWYgKCF0aGlzLl9jb250YWluZXIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb250YWluZXIgd2l0aCBzZWxlY3RvciAke2NvbnRhaW5lclNlbGVjdG9yfSBub3QgZm91bmRgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgaWYgKCF0aGlzLl9wb3B1cCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFBvcHVwIHdpdGggc2VsZWN0b3IgJHtwb3B1cFNlbGVjdG9yfSBub3QgZm91bmRgKTtcclxuICAgIH1cclxuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcclxuICB9XHJcblxyXG4gIG9wZW4oKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xyXG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgZXZ0LnRhcmdldCA9PT0gdGhpcy5fcG9wdXAgfHxcclxuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX19jbG9zZS1idXR0b25cIilcclxuICAgICAgKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKTtcclxuICAgIGlmICghdGhpcy5fZm9ybSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZvcm0gZWxlbWVudCBub3QgZm91bmQgaW4gcG9wdXAgd2l0aCBzZWxlY3RvciAke3BvcHVwU2VsZWN0b3J9YCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbChcImlucHV0XCIpKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihcImJ1dHRvblt0eXBlPSdzdWJtaXQnXVwiKTtcclxuICAgIHRoaXMuX2RlZmF1bHRCdXR0b25UZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgZm9ybURhdGEgPSB0aGlzLl9nZXRJbnB1dFZhbHVlcygpO1xyXG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KGZvcm1EYXRhKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZykge1xyXG4gICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fZGVmYXVsdEJ1dHRvblRleHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcclxuICB7XHJcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3lvc2VtaXRlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xha2UtbG91aXNlLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2JhbGQtbW91bnRhaW5zLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGF0ZW1hci5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvdmFub2lzZS5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWdvLmpwZ1wiLFxyXG4gIH0sXHJcbl07XHJcbmV4cG9ydCBjb25zdCBmb3JtU2V0dGluZ3MgPSB7XHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b24tc2F2ZVwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbi1zYXZlX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXQtZXJyb3JfYWN0aXZlXCIsXHJcbn07IiwiaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvcG9wdXB3aXRoY29uZmlybWF0aW9uLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XHJcbmltcG9ydCBcIi4uL3BhZ2VzL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgeyBmb3JtU2V0dGluZ3MgfSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCI4NGZkYWM2My1jYTJmLTQ5ODYtYmRkOC1iYjFmYmJmZjI3NWZcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuYXBpXHJcbiAvLyAuZ2V0SW5pdGlhbENhcmRzKClcclxuICAvLy50aGVuKChjYXJkcykgPT4ge1xyXG4gICAgLy9jYXJkcy5mb3JFYWNoKChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAvL2NvbnN0IGNhcmQgPSBuZXcgQ2FyZChjYXJkRGF0YSwgXCIjY2FyZC10ZW1wbGF0ZVwiKTtcclxuICAgICAgLy9jb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgICAgIC8vY2FyZENvbnRhaW5lci5wcmVwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgIC8vfSk7XHJcbiAgLy99KVxyXG5cclxubGV0IGNhcmRTZWN0aW9uO1xyXG5Qcm9taXNlLmFsbChbYXBpLmdldFVzZXJJbmZvKCksIGFwaS5nZXRJbml0aWFsQ2FyZHMoKV0pXHJcbiAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZHNEYXRhXSkgPT4ge1xyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxyXG4gICAgICBqb2I6IHVzZXJEYXRhLmFib3V0LFxyXG4gICAgICBhdmF0YXI6IHVzZXJEYXRhLmF2YXRhcixcclxuICAgIH0pO1xyXG4gICAgY2FyZFNlY3Rpb24gPSBuZXcgU2VjdGlvbihcclxuICAgICAge1xyXG4gICAgICAgIGl0ZW1zOiBjYXJkc0RhdGEsXHJcbiAgICAgICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoaXRlbSk7XHJcbiAgICAgICAgICBjYXJkU2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgICBcIi5jYXJkc19fbGlzdFwiXHJcbiAgICApO1xyXG4gICAgY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBpbml0aWFsIGRhdGEgZnJvbSBzZXJ2ZXI6XCIsIGVycik7XHJcbiAgfSk7XHJcblxyXG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LWZvcm1cIik7XHJcbmNvbnN0IGFkZFBsYWNlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLW5ldy1wbGFjZS1mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItZm9ybVwiKTtcclxuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1idXR0b25cIik7XHJcbmNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuY29uc3QgYXZhdGFyRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWVkaXQtYnV0dG9uXCIpO1xyXG5jb25zdCBwcm9maWxlVGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS10aXRsZS1pbnB1dFwiKTtcclxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxyXG4pO1xyXG5cclxuY29uc3QgY2FyZFNlbGVjdG9yID0gXCIjY2FyZC10ZW1wbGF0ZVwiO1xyXG5cclxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fdGl0bGVcIixcclxuICBqb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcclxuICBhdmF0YXJTZWxlY3RvcjogXCIucHJvZmlsZV9faW1hZ2VcIixcclxufSk7XHJcblxyXG5jb25zdCBhdmF0YXJQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI2F2YXRhci1tb2RhbFwiLCAoZm9ybURhdGEpID0+IHtcclxuICBhdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLnVwZGF0ZUF2YXRhcih7IGF2YXRhcjogZm9ybURhdGEuYXZhdGFyIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcclxuICAgICAgICBuYW1lOiByZXMubmFtZSxcclxuICAgICAgICBqb2I6IHJlcy5hYm91dCxcclxuICAgICAgICBhdmF0YXI6IHJlcy5hdmF0YXIsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhdmF0YXJQb3B1cC5jbG9zZSgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgYXZhdGFyOlwiLCBlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBhdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxuYXZhdGFyUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtU2V0dGluZ3MsIGF2YXRhckZvcm0pO1xyXG5hdmF0YXJGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGF2YXRhckZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgYXZhdGFyUG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmNvbnN0IHBvcHVwV2l0aEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiI3BpY3R1cmUtbW9kYWxcIik7XHJcbnBvcHVwV2l0aEltYWdlLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBlZGl0UHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXHJcbiAgKGZvcm1EYXRhKSA9PiB7XHJcbiAgICBlZGl0UHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XHJcbiAgICBhcGlcclxuICAgICAgLnVwZGF0ZVVzZXJQcm9maWxlKHsgbmFtZTogZm9ybURhdGEudGl0bGUsIGFib3V0OiBmb3JtRGF0YS5kZXNjcmlwdGlvbiB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICAgICAgbmFtZTogcmVzLm5hbWUsXHJcbiAgICAgICAgICBqb2I6IHJlcy5hYm91dCxcclxuICAgICAgICAgIGF2YXRhcjogcmVzLmF2YXRhcixcclxuICAgICAgICB9KTtcclxuICAgICAgICBlZGl0UHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgcHJvZmlsZTpcIiwgZXJyKSlcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIGVkaXRQcm9maWxlUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuKTtcclxuZWRpdFByb2ZpbGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgYWRkQ2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIjcHJvZmlsZS1hZGQtbW9kYWxcIiwgKGZvcm1EYXRhKSA9PiB7XHJcbiAgYWRkQ2FyZFBvcHVwLnJlbmRlckxvYWRpbmcodHJ1ZSk7XHJcbiAgYXBpXHJcbiAgICAuYWRkTmV3Q2FyZCh7IG5hbWU6IGZvcm1EYXRhLnRpdGxlLCBsaW5rOiBmb3JtRGF0YS51cmwgfSlcclxuICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdDYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xyXG4gICAgICBjYXJkU2VjdGlvbi5hZGRJdGVtKG5ld0NhcmRFbGVtZW50KTtcclxuICAgICAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhZGRpbmcgbmV3IGNhcmQ6XCIsIGVycikpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIGFkZENhcmRQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxuYWRkQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBkZWxldGVDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoQ29uZmlybWF0aW9uKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xyXG5kZWxldGVDYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmREZWxldGUoY2FyZEluc3RhbmNlKSB7XHJcbiAgZGVsZXRlQ2FyZFBvcHVwLnNldFN1Ym1pdEFjdGlvbigoKSA9PiB7XHJcbiAgICBhcGlcclxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZEluc3RhbmNlLl9pZClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNhcmRJbnN0YW5jZS5yZW1vdmVDYXJkKCk7XHJcbiAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgY2FyZDpcIiwgZXJyKSk7XHJcbiAgfSk7XHJcbiAgZGVsZXRlQ2FyZFBvcHVwLm9wZW4oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZExpa2UoY2FyZEluc3RhbmNlKSB7XHJcbiAgaWYgKCFjYXJkSW5zdGFuY2UuX2lzTGlrZWQpIHtcclxuICAgIGFwaVxyXG4gICAgICAubGlrZUNhcmQoY2FyZEluc3RhbmNlLl9pZClcclxuICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XHJcbiAgICAgICAgY2FyZEluc3RhbmNlLnVwZGF0ZUxpa2VTdGF0ZSh0cnVlKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsaWtpbmcgY2FyZDpcIiwgZXJyKSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFwaVxyXG4gICAgICAuZGlzbGlrZUNhcmQoY2FyZEluc3RhbmNlLl9pZClcclxuICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XHJcbiAgICAgICAgY2FyZEluc3RhbmNlLnVwZGF0ZUxpa2VTdGF0ZShmYWxzZSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGlzbGlraW5nIGNhcmQ6XCIsIGVycikpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayhkYXRhKSB7XHJcbiAgcG9wdXBXaXRoSW1hZ2Uub3BlbihkYXRhLm5hbWUsIGRhdGEubGluayk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoZGF0YSkge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIGRhdGEsXHJcbiAgICBjYXJkU2VsZWN0b3IsXHJcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxyXG4gICAgaGFuZGxlQ2FyZERlbGV0ZSxcclxuICAgIGhhbmRsZUNhcmRMaWtlXHJcbiAgKTtcclxuICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxufVxyXG5cclxuY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtU2V0dGluZ3MsIHByb2ZpbGVGb3JtKTtcclxucHJvZmlsZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuY29uc3QgYWRkUGxhY2VGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybVNldHRpbmdzLCBhZGRQbGFjZUZvcm0pO1xyXG5hZGRQbGFjZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjb25zdCBjdXJyZW50VXNlciA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XHJcbiAgcHJvZmlsZVRpdGxlSW5wdXQudmFsdWUgPSBjdXJyZW50VXNlci5uYW1lO1xyXG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gY3VycmVudFVzZXIuam9iO1xyXG4gIHByb2ZpbGVGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGVkaXRQcm9maWxlUG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGFkZFBsYWNlRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcclxuICBhZGRDYXJkUG9wdXAub3BlbigpO1xyXG59KTtcclxuXHJcbmF2YXRhckVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhdmF0YXJGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGF2YXRhclBvcHVwLm9wZW4oKTtcclxufSk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgdGhpcy5fYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICAgIGlmIChyZXMub2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRVc2VySW5mbygpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBOZXR3b3JrIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgTmV0d29yayBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBkYXRlVXNlclByb2ZpbGUoZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXHJcbiAgICAgICAgICBhYm91dDogZGF0YS5hYm91dCxcclxuICAgICAgICB9KSxcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYE5ldHdvcmsgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHVwZGF0ZUF2YXRhcihkYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBhdmF0YXI6IGRhdGEuYXZhdGFyLFxyXG4gICAgICAgIH0pLFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgTmV0d29yayBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgYWRkTmV3Q2FyZChkYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgICAgbGluazogZGF0YS5saW5rLFxyXG4gICAgICAgIH0pLFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgTmV0d29yayBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiB0aGlzLl9jaGVja1Jlc3BvbnNlKHJlcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYE5ldHdvcmsgZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xyXG4gICAgICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrUmVzcG9uc2UocmVzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgTmV0d29yayBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGlzbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gdGhpcy5fY2hlY2tSZXNwb25zZShyZXMpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBOZXR3b3JrIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBqb2JTZWxlY3RvciwgYXZhdGFyU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2pvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9uYW1lIHx8ICF0aGlzLl9qb2IgfHwgIXRoaXMuX2F2YXRhcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPbmUgb3IgbW9yZSBzZWxlY3RvcnMgYXJlIGludmFsaWRcIik7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgam9iLCBhdmF0YXIgfSkge1xyXG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB0aGlzLl9qb2IudGV4dENvbnRlbnQgPSBqb2I7XHJcbiAgICBpZiAoYXZhdGFyKSB7XHJcbiAgICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5fbmFtZS50ZXh0Q29udGVudCxcclxuICAgICAgam9iOiB0aGlzLl9qb2IudGV4dENvbnRlbnRcclxuICAgIH07XHJcbiAgfVxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBvcGVuKG5hbWUsIGxpbmspIHtcclxuICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgY29uc3QgY2FwdGlvbkVsZW1lbnQgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xyXG5cclxuICAgIGlmICghaW1hZ2VFbGVtZW50IHx8ICFjYXB0aW9uRWxlbWVudCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbWFnZSBvciBjYXB0aW9uIGVsZW1lbnQgbm90IGZvdW5kIGluIHBvcHVwXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGltYWdlRWxlbWVudC5zcmMgPSBsaW5rO1xyXG4gICAgaW1hZ2VFbGVtZW50LmFsdCA9IG5hbWU7XHJcbiAgICBjYXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcblxyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpO1xyXG4gICAgaWYgKCF0aGlzLl9mb3JtKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRm9ybSBlbGVtZW50IG5vdCBmb3VuZCBpbiBwb3B1cCB3aXRoIHNlbGVjdG9yICR7cG9wdXBTZWxlY3Rvcn1gKTtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgc2V0U3VibWl0QWN0aW9uKGFjdGlvbikge1xyXG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gYWN0aW9uO1xyXG4gIH1cclxuICBcclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgaWYgKHRoaXMuX2hhbmRsZVN1Ym1pdCkge1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlSW1hZ2VDbGljayIsImhhbmRsZUNhcmREZWxldGUiLCJoYW5kbGVDYXJkTGlrZSIsInRoaXMiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJfaXNMaWtlZCIsImlzTGlrZWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlQ2FyZERlbGV0ZSIsIl9oYW5kbGVDYXJkTGlrZSIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJfbGlrZUJ1dHRvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJfZGVsZXRlQnV0dG9uIiwiX2NhcmRJbWFnZUVsZW1lbnQiLCJ1cGRhdGVMaWtlU3RhdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJyZW1vdmVDYXJkIiwiX2VsZW1lbnQiLCJnZW5lcmF0ZUNhcmQiLCJ0ZXh0Q29udGVudCIsInNyYyIsImFsdCIsIkZvcm1WYWxpZGF0b3IiLCJzZXR0aW5ncyIsImZvcm1FbGVtZW50IiwiX3NldHRpbmdzIiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX2J1dHRvbkVsZW1lbnQiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9oYXNJbnZhbGlkSW5wdXQiLCJzb21lIiwiaW5wdXRFbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImRpc2FibGVCdXR0b24iLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiZXJyb3JFbGVtZW50IiwiaWQiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJmb3JFYWNoIiwiZW5hYmxlVmFsaWRhdGlvbiIsInJlc2V0VmFsaWRhdGlvbiIsIlNlY3Rpb24iLCJfcmVmIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIkVycm9yIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwIiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2Zvcm0iLCJfc3VibWl0QnV0dG9uIiwiX2RlZmF1bHRCdXR0b25UZXh0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiZm9ybURhdGEiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwicmVzZXQiLCJmb3JtU2V0dGluZ3MiLCJhcGkiLCJvcHRpb25zIiwiX2Jhc2VVcmwiLCJiYXNlVXJsIiwiX2hlYWRlcnMiLCJoZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsImVycm9yIiwibWVzc2FnZSIsImdldEluaXRpYWxDYXJkcyIsInVwZGF0ZVVzZXJQcm9maWxlIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhYm91dCIsInVwZGF0ZUF2YXRhciIsImF2YXRhciIsImFkZE5ld0NhcmQiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJkaXNsaWtlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJjYXJkU2VjdGlvbiIsImFsbCIsInRoZW4iLCJ1c2VyRGF0YSIsImNhcmRzRGF0YSIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJqb2IiLCJjYXJkRWxlbWVudCIsImNyZWF0ZUNhcmQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJwcm9maWxlRm9ybSIsImFkZFBsYWNlRm9ybSIsImF2YXRhckZvcm0iLCJwcm9maWxlRWRpdEJ1dHRvbiIsImFkZEJ1dHRvbiIsImF2YXRhckVkaXRCdXR0b24iLCJwcm9maWxlVGl0bGVJbnB1dCIsInByb2ZpbGVEZXNjcmlwdGlvbklucHV0IiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJhdmF0YXJTZWxlY3RvciIsIl9qb2IiLCJfYXZhdGFyIiwiX3JlZjIiLCJhdmF0YXJQb3B1cCIsImZpbmFsbHkiLCJhdmF0YXJGb3JtVmFsaWRhdG9yIiwicG9wdXBXaXRoSW1hZ2UiLCJpbWFnZUVsZW1lbnQiLCJjYXB0aW9uRWxlbWVudCIsImVkaXRQcm9maWxlUG9wdXAiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiYWRkQ2FyZFBvcHVwIiwidXJsIiwiY2FyZERhdGEiLCJuZXdDYXJkRWxlbWVudCIsImRlbGV0ZUNhcmRQb3B1cCIsInNldFN1Ym1pdEFjdGlvbiIsImFjdGlvbiIsIl9oYW5kbGVTdWJtaXQiLCJjYXJkSW5zdGFuY2UiLCJ1cGRhdGVkQ2FyZCIsInByb2ZpbGVGb3JtVmFsaWRhdG9yIiwiYWRkUGxhY2VGb3JtVmFsaWRhdG9yIiwiY3VycmVudFVzZXIiXSwic291cmNlUm9vdCI6IiJ9